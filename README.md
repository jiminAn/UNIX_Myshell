# 유닉스 프로그래밍 프로젝트1 과제

## 주제설명

### 주제

리눅스 환경에서 나만의 셸(SMUshell) 만들기

### 설명

shell이란 표준 입력으로부터 커맨드 라인을 읽고, 입력된 라인을 해석하여 이에 해당하는 명령을 실행시킨다. shell의 가장 간단한 동작방식은 명령을 표준 입력으로부터 읽어들인 후, 명령을 실행시킬 자식 프로세스를 fork하는 것이다. 그 후 부모 프로세스는 다른 명령을 읽어들이기 전에 자식 프로세스가 종료할 때까지 기다린다. 또한 shell은 파이프 라인과 재지향 외에 시그널을 처리하며 본 과제는 이러한 shell을 부분적이지만 전체를 아우를 수 있는 스뮤셸(SMUshell)을 작성하는 것으로 초점을 두었다.



## 시스템 설계도



## 사용된 기술

### 시그널 처리

일반적으로 수행되는 프로세스의 경우 Ctrl+C(SIGINT) 시그널을 통하여 수행중인 프로세스를 종료시킬 수 있지만,  SMUshell의 경우엔 이러한 시그널을 무시하도록 처리하였다.  SMUshell의 종료는 exit이라는 셸 내부 명령어를 통해서만 가능하도록 처리하였다

### 파이프 라인 

**[Implementation of multipe pipes in C](http://stackoverflow.com/questions/8389033/implementation-of-multiple-pipes-in-c) 을 참고하여 smu_shell.c의 recurPipe()함수를 작성하였습니다**

original parent process는 각 명령어를 위해서 child를 생성하므로 ordeal 내내 살아남을 수 있음. 자식은 이전 명령에서 입력을 받아야 하는지, 출력을 다음 명령으로 보내야 하는지 여부를 확인한다. 그런 다음 pipe file descriptor의 모든 복사본을 모두 닫은 후 실행한다. 부모는 명령마다 자식을 생성할때 까지 fork외에는 아무것도 하지 않는다. 이후, 부모는 descriptor의 모든 복사본을 닫고 wait를 할 수 있다.

필요한 파이프를 모두 만든 다음 루프에서 관리를 위해 배열 pipefds[]를 사용하였다.

### 재지향 

 smu_shell.c의 myexecu()함수를 사용해서 redirection 명령어가 들어올 경우 처리하였다. 명령인자에서 >,< 여부를 각각 확인하고 >가 들어왔을 경우 파일 쓰기를 실행, <가 들어왔을 경우 파일 읽기를 실행하였다. 또한 해당 함수내에서 그 외에 명령어가 들어왔을 경우, 시스템에서 제공하는 함수들을 사용하여 처리해주었다.

## 사용 메뉴얼



### SMUshell의 파일 구성

1. smu_shell.c : 메인 함수 및 기타 함수들(파이프라인 처리)
2. support.c : shell의 기능을 구현한 함수들
3. support.h : 헤더파일 및 연결리스트 구조체, 함수 프로토타입 정의
4. Makefile
   - $make : support.c, smu_shell.c 코드 컴파일
   - $clean : \rm *.o smu_shell 수행
   - $./smu_shell : make로 컴파일 후 코드 실행 가능

### 스뮤셸의 실행 과정

프롬프트가 뜨고, 그 후 입력받은 명령들은 fork()  함수를 통하여 자식 프로세스에서 수행된다. 부모 프로세스의 경우는 자식 프로세스의 동작이 완료될 때까지 wait했다가 수행이 종료되면 다시 프롬프트를 띄우는 역할을 하게 된다. Fork()함수를 통하여 생성된 자식 프로세스는 명령어들을 분리한 argument vector table에 의하여 exec계열의 함수를 통하여 실행이 된다. 통상적으로 쓰이는 함수는 execv(), execvp()인데, 전자는 실행 파일의 절대경로를 포함하는 반면에 후자는 사용자 경로가 지정하고 있는 디렉토리를 사용하면 된다



### SMUshell의 명령어

SMUshell은 기본 리눅스 셸에서 사용하는 일반적인 명령어들을 입력하여 실행시킬 수 있으며, 몇 가지 셸 내부 명령어는 직접 작성한 함수 형태로 실행하게 된다. 

재정의한 셸 내부 명령어의 종류는 다음과 같다

path, cd, exit



## 사용 예

